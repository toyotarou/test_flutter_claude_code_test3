# Flutter 競馬成績アプリ 要件定義書

> **要件定義書とは？**
>
> 要件定義書は設計書よりもさらに **上流** のドキュメントです。
> 「何を作るか」を決める前に「なぜ作るのか」「誰のために作るのか」「どんな課題を解決するのか」を定義します。
>
> **ドキュメントの位置づけ:**
>
> ```
> 要件定義書    →  基本設計書    →  詳細設計書    →  実装
> (なぜ作るか)    (何を作るか)    (どう作るか)    (コードを書く)
> ```
>
> | 観点 | 要件定義書 | 基本設計書 | 詳細設計書 |
> |---|---|---|---|
> | 主な読者 | 発注者・経営者・PM | PM・開発リーダー | 開発者 |
> | 記述レベル | ビジネス・業務の言葉 | 機能とシステムの言葉 | 技術・実装の言葉 |
> | 主な内容 | 目的・課題・要望 | 機能一覧・画面設計 | クラス・関数・DB定義 |
> | 例 | 「馬の過去成績を簡単に確認したい」 | 「F-04: 馬名検索機能」 | 「toKatakana()で変換しstartsWith()で前方一致」 |
>
> **なぜ要件定義書が必要か：**
>
> 要件定義がないまま設計・実装を始めると、以下のような問題が起きます。
> - 「思ってたのと違う」 → 手戻りが発生する
> - 「あの機能も欲しい」 → 際限なく機能が増える（スコープクリープ）
> - 「そもそも何のために作ったんだっけ」 → プロジェクトの方向性を見失う
>
> 要件定義書の各セクションの役割:
>
> | セクション | 書く内容 | なぜ必要か |
> |---|---|---|
> | 1. プロジェクト背景 | なぜこのプロジェクトを始めるのか | 判断に迷ったとき「原点」に戻れるようにするため |
> | 2. 目的とゴール | 何を達成すれば成功なのか | 完了条件を明確にするため |
> | 3. ステークホルダー | 誰が関係者か | 意思決定者と利用者を明確にするため |
> | 4. 現状の課題 | 今何が困っているのか | 「解決すべき問題」を全員で共有するため |
> | 5. 業務フロー | ユーザーがどう使うか | 実際の利用シーンを想像するため |
> | 6. 機能要件 | 何ができればよいか | 開発範囲の合意を取るため |
> | 7. 非機能要件 | どの程度の品質が必要か | 「動くけど使えない」を防ぐため |
> | 8. 制約条件 | 守るべきルール・制限 | 技術選定や予算の前提を共有するため |
> | 9. リスク | 何が問題になりそうか | 事前に対策を打つため |
> | 10. 受入条件 | 何をもって完成とするか | 「終わり」を定義するため |

---

## 1. プロジェクト背景

> **このセクションの目的：** 「このプロジェクトはなぜ始まったのか」を記述する。背景を書くことで、開発中に判断に迷ったとき「そもそもの目的は何だったか」に立ち返ることができる。

### 1.1 背景

競馬のレース結果は netkeiba.com をはじめとする複数のWebサイトで公開されている。しかし、以下のような課題があった。

- 特定の馬の過去成績を確認するには、複数のページを行き来する必要がある
- 成績の推移（調子が上がっているか下がっているか）を直感的に把握しにくい
- スマートフォンから手軽に閲覧できる個人向けの軽量なアプリがない

同時に、開発者自身のスキル向上のため、以下の技術を実践的に学習する機会を求めていた。

- Flutter によるモバイルアプリ開発
- Go 言語による REST API サーバー構築
- Riverpod / freezed 等の Flutter エコシステム

これらの課題と学習目標を同時に満たすプロジェクトとして、本アプリの開発を開始した。

### 1.2 プロジェクト名

**競馬成績閲覧アプリ (flutter_hourse_race_result)**

---

## 2. 目的とゴール

> **このセクションの目的：** プロジェクトの成功基準を定義する。「何ができたら完成なのか」が曖昧だと、永遠に終わらないプロジェクトになってしまう。

### 2.1 ビジネス目的

> **補足：** 個人開発であっても「ビジネス目的」を書くのは良い習慣。企業のプロジェクトでは「売上を10%向上する」「問い合わせを50%削減する」のような数値目標が入る。

| # | 目的 |
|---|---|
| 1 | 競馬のレース結果を手軽にモバイルで閲覧できるようにする |
| 2 | 馬の成績推移を直感的に把握できるようにする |
| 3 | Flutter / Go の実践的な開発スキルを習得する |

### 2.2 達成指標

> **補足：** 達成指標は、できるだけ **客観的に判定できるもの** にする。「使いやすい」は主観的で判定できないが、「3タップ以内で検索結果にたどり着ける」は客観的に判定できる。

| # | 指標 | 達成基準 |
|---|---|---|
| 1 | レース一覧表示 | 全レースが日付順に正しく表示される |
| 2 | 検索到達性 | 馬名入力から検索結果表示まで3タップ以内 |
| 3 | グラフ可視化 | 2件以上の成績がある馬の着順推移がグラフで表示される |
| 4 | レスポンス | アプリ起動からレース一覧表示まで3秒以内（Wi-Fi環境） |
| 5 | 学習成果 | Riverpod / freezed / flutter_hooks を活用した実装がされている |

---

## 3. ステークホルダー

> **このセクションの目的：** プロジェクトに関わる「人」を明確にする。
>
> **補足：** ステークホルダーとは「利害関係者」のこと。企業プロジェクトでは多くの関係者がいるが、個人開発でも「誰が使うのか」「誰が決定権を持つのか」を整理しておくと、判断が早くなる。

| 役割 | 担当 | 責任 |
|---|---|---|
| プロジェクトオーナー | 開発者本人 | 要件の決定、優先順位の判断 |
| 開発者 | 開発者本人 + AI（Claude） | 設計・実装・テスト |
| エンドユーザー | 開発者本人（将来的に知人にも共有） | アプリの利用、フィードバック |

---

## 4. 現状の課題

> **このセクションの目的：** 「今、何が困っているのか」を書く。課題が明確であれば、その課題を解決する機能だけを作ればよいので、ムダな開発を避けられる。

### 4.1 課題一覧

| 課題ID | カテゴリ | 課題内容 | 影響度 |
|---|---|---|---|
| P-01 | 情報アクセス | 競馬の結果を確認するのに複数のWebサイトを開く必要がある | 中 |
| P-02 | 情報アクセス | 特定の馬の過去全成績を一覧で見る手段が限られている | 高 |
| P-03 | 可視化 | 馬の調子（着順の推移）を直感的に把握できない | 高 |
| P-04 | 利便性 | スマートフォンでサクサク見れる競馬成績アプリがない | 中 |
| P-05 | 学習 | Flutter / Go の実践的な学習教材がほしい | 中 |

### 4.2 課題と機能の対応

> **補足：** この対応表を作ることで「この機能はどの課題を解決するために作るのか」が明確になる。課題に紐づかない機能は不要な可能性がある。

| 課題ID | 解決する機能 |
|---|---|
| P-01 | レース一覧表示、年フィルタリング |
| P-02 | 馬名検索、馬名一覧 |
| P-03 | 成績グラフ表示 |
| P-04 | モバイルアプリ化（Flutter） |
| P-05 | プロジェクト全体（技術スタックの選定） |

---

## 5. 業務フロー（ユースケース）

> **このセクションの目的：** ユーザーが実際にどのようにアプリを使うかを、具体的なシナリオで描く。
>
> **補足：** 「ユースケース」とは「利用者がシステムを使って何かを達成する一連の流れ」のこと。画面の細かいデザインではなく、ユーザーの「行動」に注目して書く。

### UC-01: レース結果を確認する

```
目的:     特定の日のレース結果（着順）を確認する
利用者:   エンドユーザー
事前条件:  アプリがインストールされ、ネットワークに接続されている

基本フロー:
  1. ユーザーがアプリを開く
  2. システムがレース一覧を表示する
  3. ユーザーが見たい年をタップする（任意）
  4. システムが選択した年のレースだけに絞り込む
  5. ユーザーが見たいレースをタップする
  6. システムがそのレースの着順結果を表示する
  7. ユーザーが結果を確認する

代替フロー:
  3a. 年を選ばない場合、全年のレースが表示される
  6a. 結果がない場合、「No results」と表示する

例外フロー:
  2a. ネットワークエラーの場合
      → エラーメッセージとリトライボタンを表示する
```

### UC-02: 馬の過去成績を検索する

```
目的:     特定の馬の過去の全成績を確認する
利用者:   エンドユーザー
事前条件:  アプリがインストールされ、ネットワークに接続されている

基本フロー:
  1. ユーザーが検索バーに馬名を入力する
  2. システムが入力文字に一致する候補を表示する（リアルタイム）
  3. ユーザーが候補から馬名を選択する
  4. システムがその馬の全成績を取得して表示する
  5. ユーザーがグラフと成績リストを確認する

代替フロー:
  1a. ひらがなで入力した場合
      → システムが自動でカタカナに変換して候補を表示する
  3a. 候補を選ばず検索ボタンを押した場合
      → 入力した文字で部分一致検索を行う
  4a. 該当する馬がいない場合
      → 「該当する馬が見つかりません」と表示する

事後条件:  2件以上の成績がある場合、着順推移グラフが表示されている
```

### UC-03: 馬名一覧から成績を見る

```
目的:     全馬名を一覧し、気になる馬の成績を確認する
利用者:   エンドユーザー
事前条件:  アプリがインストールされ、ネットワークに接続されている

基本フロー:
  1. ユーザーが一覧ボタンをタップする
  2. システムが全馬名をあいうえお順に表示する
  3. ユーザーが出走回数やアクティブ状態を確認する
  4. ユーザーが気になる馬名をタップする
  5. システムがその馬の全成績を表示する

代替フロー:
  3a. 非アクティブな馬（去年・今年に出走なし）はグレーで表示される
      → ユーザーは現役の馬を視覚的に判別できる
```

### ユースケース図

```
                    ┌─────────────────────────────────────┐
                    │          競馬成績アプリ               │
                    │                                     │
 ┌──────┐          │  ┌───────────────────────────────┐  │
 │      │          │  │ UC-01: レース結果を確認する      │  │
 │      │─────────►│  └───────────────────────────────┘  │
 │      │          │                                     │
 │ユーザー│          │  ┌───────────────────────────────┐  │
 │      │─────────►│  │ UC-02: 馬の過去成績を検索する    │  │
 │      │          │  └───────────────────────────────┘  │
 │      │          │                                     │
 │      │          │  ┌───────────────────────────────┐  │
 │      │─────────►│  │ UC-03: 馬名一覧から成績を見る    │  │
 └──────┘          │  └───────────────────────────────┘  │
                    │                                     │
                    └─────────────────────────────────────┘
```

---

## 6. 機能要件

> **このセクションの目的：** アプリに「何ができてほしいか」を要望レベルで列挙する。基本設計書の機能一覧（F-01〜F-10）の元になるリスト。
>
> **補足：** 要件定義書では「検索機能がほしい」のような要望レベルで書く。それを「前方一致で絞り込む」のように具体化するのは基本設計書の役割。

### 6.1 要件一覧

| 要件ID | カテゴリ | 要件 | 優先度 | 対応課題 |
|---|---|---|---|---|
| REQ-01 | 閲覧 | レースの一覧を見ることができる | 必須 | P-01 |
| REQ-02 | 閲覧 | 年ごとにレースを絞り込むことができる | 必須 | P-01 |
| REQ-03 | 閲覧 | レースの着順結果を見ることができる | 必須 | P-01 |
| REQ-04 | 検索 | 馬名を入力して成績を検索できる | 必須 | P-02 |
| REQ-05 | 検索 | ひらがなでも馬名を検索できる | 必須 | P-04 |
| REQ-06 | 検索 | 入力中に候補が表示される | 重要 | P-04 |
| REQ-07 | 閲覧 | 全馬名を一覧で見ることができる | 重要 | P-02 |
| REQ-08 | 可視化 | 馬の着順推移をグラフで見ることができる | 重要 | P-03 |
| REQ-09 | 表示 | 最近出走していない馬が見分けられる | 任意 | P-02 |
| REQ-10 | 表示 | レースのグレードが視覚的にわかる | 任意 | P-01 |

### 6.2 優先度の定義

| 優先度 | 定義 | 判断基準 |
|---|---|---|
| 必須 (Must) | この要件が満たされないとリリースできない | アプリの核となる機能 |
| 重要 (Should) | 可能な限り実装すべき | ユーザー体験を大きく向上させる |
| 任意 (Could) | あれば嬉しい | なくてもアプリとして成立する |

> **補足：** この優先度分類は「MoSCoW法」と呼ばれる手法に基づいている。Must / Should / Could / Won't の頭文字を取ったもの。企業の開発現場でよく使われる。

---

## 7. 非機能要件

> **このセクションの目的：** 「機能」以外の品質に関する要件を定義する。
>
> **補足：** 「計算が正しい」は機能要件。「計算が1秒以内に終わる」は非機能要件。どちらも重要だが、非機能要件は見落とされがちなので、意識的に書き出す必要がある。

### 7.1 性能

| 要件ID | 要件 | 基準値 | 備考 |
|---|---|---|---|
| NFR-01 | アプリ起動からデータ表示まで | 3秒以内 | Wi-Fi環境を前提 |
| NFR-02 | 検索サジェストの応答 | 100ms以内 | ローカル処理のため |
| NFR-03 | ダイアログ表示 | 2秒以内 | API応答時間に依存 |

### 7.2 可用性（アベイラビリティ）

> **補足：** 可用性とは「使いたいときに使えること」。サーバーが落ちていたらどうするか、等を定義する。

| 要件ID | 要件 |
|---|---|
| NFR-04 | サーバーが停止していてもアプリはクラッシュしない |
| NFR-05 | 通信エラー時はエラーメッセージとリトライ手段を提供する |
| NFR-06 | API応答がない場合はローディング表示で待機する |

### 7.3 ユーザビリティ（使いやすさ）

| 要件ID | 要件 | 理由 |
|---|---|---|
| NFR-07 | 画面は縦固定とする | 競馬データは縦スクロールと相性が良い |
| NFR-08 | ダークテーマを採用する | 長時間閲覧時の目の負担を軽減 |
| NFR-09 | ひらがな入力に対応する | カタカナへの切り替えが面倒 |
| NFR-10 | 画面のどこをタップしてもキーボードが閉じる | 誤操作防止 |
| NFR-11 | 着順を色で直感的に判別できるようにする | 1着=金、2着=銀、3着=銅 |

### 7.4 保守性（メンテナンスのしやすさ）

> **補足：** 保守性とは「後から修正・拡張がしやすいこと」。今は個人開発でも、半年後の自分が「このコードどういう意味だっけ」とならないために重要。

| 要件ID | 要件 | 理由 |
|---|---|---|
| NFR-12 | API接続先は1箇所で変更可能にする | サーバー移行時の影響を最小化 |
| NFR-13 | 画面とデータ取得ロジックは分離する | 変更時の影響範囲を限定する |
| NFR-14 | データモデルはコード生成で型安全性を担保する | 手書きによるバグを防ぐ |
| NFR-15 | ファイルは役割ごとにディレクトリを分割する | 目的のファイルを見つけやすくする |

### 7.5 セキュリティ

| 要件ID | 要件 | 現状 | 今後の対応 |
|---|---|---|---|
| NFR-16 | 通信の暗号化 | HTTP（非暗号化） | HTTPS化を推奨 |
| NFR-17 | アクセス制御 | なし（認証不要） | 必要時にAPI Key導入 |
| NFR-18 | データは閲覧専用 | 書き込み機能なし | 変更なし |

### 7.6 互換性

| 要件ID | 要件 |
|---|---|
| NFR-19 | Android と iOS の両方で動作すること |
| NFR-20 | 画面サイズに応じて適切に表示されること（レスポンシブ） |

---

## 8. 制約条件

> **このセクションの目的：** 開発における「前提」や「制限」を明記する。制約を把握しておくことで、実現不可能な要件を初期段階で排除できる。
>
> **補足：** 制約条件には「技術的な制約」「コスト・リソースの制約」「外部の制約」がある。

### 8.1 技術的制約

| # | 制約 | 理由 |
|---|---|---|
| 1 | フロントエンドは Flutter で開発する | 学習目的。クロスプラットフォーム対応 |
| 2 | バックエンドは Go で開発する | 学習目的。軽量なAPIサーバー |
| 3 | 状態管理は Riverpod を使用する | Flutter公式推奨に準拠した学習 |
| 4 | データモデルは freezed を使用する | 型安全性とイミュータブル性の担保 |
| 5 | データベースは MySQL を使用する | 既存の環境を活用 |

### 8.2 リソース制約

| # | 制約 | 内容 |
|---|---|---|
| 1 | 開発者 | 1名（個人開発） |
| 2 | 予算 | 無料の範囲（サーバーは既存のものを利用） |
| 3 | 開発ツール | AI（Claude）をペアプログラミング的に活用 |

### 8.3 外部制約

| # | 制約 | 内容 |
|---|---|---|
| 1 | データソース | 競馬データはスクレイピング等で事前にDBに格納済み |
| 2 | ネットワーク | インターネット接続が必須（オフライン非対応） |
| 3 | サーバー | リモートサーバー (49.212.175.205) で稼働 |

---

## 9. リスクと対策

> **このセクションの目的：** 「プロジェクトの途中で何が問題になりそうか」を事前に洗い出し、対策を考えておく。
>
> **補足：** リスクとは「将来起こるかもしれない問題」のこと。起きてから対処する（事後対応）よりも、事前に対策を打っておく（予防）方がはるかにコストが低い。

| リスクID | リスク | 影響度 | 発生確率 | 対策 |
|---|---|---|---|---|
| R-01 | サーバーが停止する | 高 | 中 | エラーハンドリングとリトライ機能を実装する |
| R-02 | データ量が増えてAPIが遅くなる | 中 | 低 | 年フィルタリングでデータ量を制限。将来的にページング導入 |
| R-03 | Flutter/Riverpodの破壊的変更 | 中 | 低 | バージョンを固定し、段階的にアップグレード |
| R-04 | スクレイピング元のサイト構造変更 | 高 | 中 | データ取得部分をAPIサーバー側に集約し影響範囲を限定 |
| R-05 | 半年後にコードの意味を忘れる | 中 | 高 | 設計書を整備し、prompts.mdで開発経緯を記録する |

> **補足：** 影響度×発生確率で優先度を判断する。R-05（コードを忘れる）のように、影響度は中でも発生確率が高いものは早めに対策を打つべき。

---

## 10. 受入条件

> **このセクションの目的：** 「何をもって完成とするか」を定義する。受入条件がないと「まだ終わってないのでは」「もう少し改善できるのでは」と、いつまでも完了にならない。
>
> **補足：** 企業のプロジェクトでは、受入条件を満たしたことを発注者が確認して「検収」となる。個人開発でも「ここまでできたら一区切り」を決めておくと、達成感を得やすい。

### 10.1 機能面の受入条件

| # | 条件 | 検証方法 |
|---|---|---|
| 1 | 全レースが一覧表示される | アプリ起動後にレース一覧が表示されることを目視確認 |
| 2 | 年フィルタリングが動作する | 年をタップし、該当年のレースのみに絞り込まれることを確認 |
| 3 | レースの着順結果が表示される | レースをタップし、着順リストが表示されることを確認 |
| 4 | 馬名検索が動作する | 馬名を入力して検索し、成績が表示されることを確認 |
| 5 | ひらがな入力で検索できる | ひらがなで馬名を入力し、候補が表示されることを確認 |
| 6 | サジェストが動作する | 文字入力中に候補がリアルタイムで表示されることを確認 |
| 7 | 馬名一覧が表示される | 一覧ボタンをタップし、あいうえお順で表示されることを確認 |
| 8 | 着順グラフが表示される | 2件以上の成績がある馬で折れ線グラフが表示されることを確認 |

### 10.2 非機能面の受入条件

| # | 条件 | 検証方法 |
|---|---|---|
| 1 | アプリ起動から3秒以内にデータ表示 | Wi-Fi環境でストップウォッチ計測 |
| 2 | 通信エラー時にクラッシュしない | サーバーを停止した状態でアプリを起動し、エラー表示を確認 |
| 3 | Android実機で正常動作 | Pixel 6a 実機でテスト |
| 4 | 画面が縦固定されている | 端末を横にしても画面が回転しないことを確認 |

### 10.3 現在のステータス

> **補足：** 受入条件の達成状況を記録しておくと、プロジェクトの進捗が一目でわかる。

| # | 条件 | ステータス |
|---|---|---|
| 機能1〜8 | 全機能の受入条件 | **達成済み** |
| 非機能1〜4 | 全非機能の受入条件 | **達成済み** |

---

## 付録A: 用語集

> **補足：** 要件定義書は非技術者も読む可能性があるため、技術用語やドメイン用語を定義しておく。基本設計書の用語集と重複してもよい（読者が異なるため）。

| 用語 | 意味 |
|---|---|
| ステークホルダー | プロジェクトに関係する全ての人。発注者、開発者、ユーザーなど |
| スコープ | プロジェクトの対象範囲。「作るもの」と「作らないもの」の境界線 |
| スコープクリープ | プロジェクトの進行中に範囲が際限なく膨らむこと。予防が重要 |
| ユースケース | ユーザーがシステムを使って目的を達成する一連の流れ |
| MoSCoW法 | 優先度分類手法。Must（必須）/ Should（重要）/ Could（任意）/ Won't（対象外）|
| 非機能要件 | 機能以外の品質要件。性能、可用性、セキュリティなど |
| 受入条件 | 「完成」と判断するための基準。これを満たしたらプロジェクト完了 |
| リスク | 将来起こるかもしれない問題。事前に対策を打つことが重要 |
| グレード | レースの格付け。G1（最高位）、G2、G3の順 |
| アクティブ | 去年または今年に出走がある状態 |
| サジェスト | テキスト入力中にリアルタイムで表示される候補 |
| REST API | HTTPプロトコルでデータをやりとりする設計パターン |
| JSON | JavaScript Object Notation。データ交換フォーマット |

---

## 付録B: ドキュメント体系

> **補足：** このプロジェクトのドキュメントがどう関連しているかを図示する。

```
  requirements.md (この文書)
  要件定義書
  「なぜ作るか」「何が必要か」
       │
       ▼
  basic-design.md
  基本設計書
  「何を作るか」「どう振る舞うか」
       │
       ▼
  detailed-design.md
  詳細設計書
  「どう作るか」「具体的な実装仕様」
       │
       ▼
  ソースコード
  lib/ 以下の Dart ファイル
```

| ドキュメント | ファイル | 主な読者 |
|---|---|---|
| 要件定義書 | `documents/requirements.md` | 発注者・PM・開発者 |
| 基本設計書 | `documents/basic-design.md` | PM・開発リーダー・開発者 |
| 詳細設計書 | `documents/detailed-design.md` | 開発者 |
| 開発履歴 | `prompts.md` | 開発者 |

---

## 改訂履歴

| 版 | 日付 | 内容 |
|---|---|---|
| 1.0 | 2026-02-08 | 初版作成 |
